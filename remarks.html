<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>HCMS | ë¹„ê³  ë¦¬ìŠ¤íŠ¸</title>

  <!-- ê³µìš© CSS -->
  <link rel="stylesheet" href="assets/hcms.css">

  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 24px;
      background: var(--bg);
      color: var(--text);
    }

    h1 {
      margin-bottom: 20px;
    }

    /* ===== í•„í„° ===== */
    .filter-box {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 12px;
      margin-bottom: 20px;
    }

    .filter-box input,
    .filter-box select,
    .filter-box button {
      height: 52px;
      font-size: 17px;
      padding: 0 12px;
    }

    button {
      font-weight: bold;
      cursor: pointer;
    }

    /* ===== í…Œì´ë¸” ===== */
    table {
      width: 100%;
      border-collapse: collapse;
      background: var(--panel);
    }

    th, td {
      border: 1px solid var(--line);
      padding: 14px;
      text-align: center;
      vertical-align: top;
    }

    th {
      background: #e9edf2;
    }

    td.remark {
      text-align: left;
      min-width: 520px;   /* ğŸ”¥ ë¹„ê³  í¬ê²Œ */
      white-space: pre-wrap;
    }
  </style>
</head>

<body>

<h1>ë¹„ê³  ë¦¬ìŠ¤íŠ¸</h1>

<!-- ===== í•„í„° ===== -->
<div class="filter-box">
  <input id="f_no" placeholder="í¬ë ˆì¸ ë²ˆí˜¸" />

  <select id="f_area">
    <option value="">ì§€ì—­ ì „ì²´</option>
    <option value="A">A</option>
    <option value="B">B</option>
  </select>

  <select id="f_type">
    <option value="">í¬ë ˆì¸ íƒ€ì… ì „ì²´</option>
    <option value="EOT">EOT</option>
    <option value="Suspension">Suspension</option>
    <option value="Gantry">Gantry</option>
    <option value="Post">Post</option>
    <option value="Wall">Wall</option>
    <option value="Monorail">Monorail</option>
    <option value="Service Crane">Service Crane</option>
    <option value="íƒ€ì›Œ">Tower</option>
  </select>

  <button onclick="loadRemarks()">í•„í„° ì ìš©</button>
</div>

<!-- ===== ë¦¬ìŠ¤íŠ¸ ===== -->
<table>
  <thead>
    <tr>
      <th>í¬ë ˆì¸ ë²ˆí˜¸</th>
      <th>íƒ€ì…</th>
      <th>ì§€ì—­</th>
      <th>ìœ„ì¹˜</th>
      <th>ë¹„ê³ </th>
      <th>ì‘ì„±ì¼</th>
    </tr>
  </thead>
  <tbody id="remarkList"></tbody>
</table>

<!-- Supabase -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<!-- App -->
<script src="app.js"></script>

<script>
async function loadRemarks() {
  let query = sb
    .from("remarks")
    .select(`
      crane_no,
      content,
      created_at,
      cranes (
        crane_type,
        area,
        location
      )
    `)
    .order("created_at", { ascending: false });

  const no = document.getElementById("f_no")?.value?.trim();
  const area = document.getElementById("f_area")?.value;
  const type = document.getElementById("f_type")?.value;

  if (no) query = query.ilike("crane_no", `%${no}%`);
  if (area) query = query.eq("cranes.area", area);
  if (type) query = query.eq("cranes.crane_type", type);

  const { data, error } = await query;
  if (error) {
    alert(error.message);
    return;
  }

  const tbody = document.getElementById("remarkList");
  tbody.innerHTML = "";

  data.forEach(r => {
    const c = r.cranes || {};
    const tr = document.createElement("tr");
    tr.innerHTML = `
      <td>${r.crane_no || ""}</td>
      <td>${c.crane_type || ""}</td>
      <td>${c.area || ""}</td>
      <td>${c.location || ""}</td>
      <td class="remark">${r.content || ""}</td>
      <td>${r.created_at ? r.created_at.slice(0,10) : ""}</td>
    `;
    tbody.appendChild(tr);
  });
}

document.addEventListener("DOMContentLoaded", loadRemarks);
</script>

</body>
</html>
